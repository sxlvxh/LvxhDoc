$(function(){$.ajaxSetup({contentType:"application/json;charset=utf-8",dataType:'json',complete:function(XMLHttpRequest,textStatus){try{if(XMLHttpRequest.getResponseHeader!=undefined){var sessionstatus=XMLHttpRequest.getResponseHeader("sessionstatus");if(sessionstatus=="timeout"){setTimeout(function(){location.href="../main/logout.action"},1000);$.messageDialog("本次登录已失效，请重新登陆！")}}}catch(el){window.console&&window.console.error(el)}},error:function(xhr,status,e){window.console&&window.console.error(xhr,status,e)}});$(".menu_control").bind("click",function(){var url=$(this).attr("url");var menuId=$(this).attr("id");location.href=url});$("#logout_menu").bind("click",function(){setTimeout(function(){location.href="../main/logout.action"},1000)});PLAT.pageTop();PLAT.menu()});function PlatFunc(){this.platParams=platParams;this.productParams=productParams};var PLAT=new PlatFunc();PlatFunc.prototype.pageTop=function(){var _this=this;$("#navbar").css({"background":"url('../theme/"+_this.productParams.theme+_this.productParams.topImg+"')"});$("#plat_logo").attr({"src":"../theme/"+_this.productParams.theme+_this.productParams.logo});$("#plat_system_title").html(_this.platParams.platProduct.productName)};PlatFunc.prototype.menu=function(){var _this=this;var prefixUrl="../theme/"+_this.productParams.theme;$.each($(".menu_img_t"),function(i,n){$(n).attr({src:prefixUrl+$(n).attr("imgURL")})});$("#logout_menu_img").attr({"src":prefixUrl+"/menu/left_tuichu.png"});$(".menu-toggle").attr({"src":prefixUrl+"/menu/ic_caidan.png"}).bind("mouseover",function(){$(this).attr("title","点击可伸缩菜单栏");$(this).attr({"src":prefixUrl+"/menu/ic_caidan_press.png"})}).bind("mouseout",function(){$(this).attr({"src":prefixUrl+"/menu/ic_caidan.png"})}).bind("click",function(){var sidebar=$("#sidebar");var mainContent=$(".main-content");if(sidebar.css("display")=="none"){sidebar.css({"display":"block"});sidebar.removeClass("menu-min");mainContent.css({"margin-left":"190px"})}else{sidebar.css({"display":"none"});sidebar.removeClass("menu-min");mainContent.css({"margin-left":"0px"})}})};function PlatGrid(opts){this.result=opts.result;this.pnode=$(opts.pnode);this.initGrid()};PlatGrid.prototype.initGrid=function(){var _this=this;table=$("<table/>").addClass("table table-responsive table-bordered grid");_this.thead=$("<thead id='form_head'/>");_this.tbody=$("<tbody/>");_this.tfoot=$("<tfoot/>");table.append(_this.thead).append(_this.tbody).append(_this.tfoot);_this.pnode.append(table);_this.initThead()};PlatGrid.prototype.initThead=function(){var _this=this;_this.queryForm=$("<form/>");_this.buttons=$("<div class='btn-group buttons'/>");_this.thead.append($("<tr/>").append($("<th/>").append($("<div/>").append(_this.queryForm)).append($("<div class='head_button'/>").append(_this.buttons))));$.each(_this.result.blist,function(i,n){var params={};if(n.buttonParams){params=JSON2.parse(n.buttonParams)}if("query"==n.buttonType){var button=$("<button/>").attr({"id":n.buttonCode});if(params.css){button.addClass(params.css)}if(params.img){button.append($("<i/>").addClass(params.img))}button.append(n.buttonName);_this.buttons.append(button);button.bind("click",function(){_this[n.enableDialog](n)});if(n.enableDialog=="searchBtn"){_this.searchButton=button;_this.queryForm.attr({"id":n.buttonCode});_this.drawQueryCriteria(n)}}})};PlatGrid.prototype.drawQueryCriteria=function(data){var _this=this;var opts={btnParams:data,pnode:_this.queryForm};var element=new DrawElement(opts)};PlatGrid.prototype.searchBtn=function(data){};function DrawElement(opts){this.btnParams=opts.btnParams;this.pnode=opts.pnode;this.srcData=opts.srcData;this.tempNode={};this.initElement()};DrawElement.prototype.initElement=function(){var _this=this;$.each(_this.btnParams.flist,function(i,n){if(n.enable==0){_this[n.fieldType](n)}})};DrawElement.prototype.select=function(field){var _this=this;var element;if(_this.tempNode[field.fieldName]){element=_this.tempNode[field.fieldName].element;element.empty()}else{element=$("<select/>").attr({"name":field.fieldName,"id":field.fieldName});_this.tempNode[field.fieldName]={"element":element,"field":field};_this.pnode.append($.profileInfoRow(field.fieldStyle,field.fieldLabel,element))}if(field.fieldParams){try{var initParam=JSON2.parse(field.fieldParams);if(initParam.staticResult){$.each(initParam.staticResult,function(i,n){element.append($("<option/>").attr({"value":n.value}).html(n.label))})}if(initParam.dynamicResult){var q=$.getPostParams(initParam.dynamicResult.postDynamicParam,_this.srcData);q=$.extend(q,initParam.dynamicResult.postStaticData);var opt={async:false,url:initParam.dynamicResult.url,data:q,success:function(msg){element.find(".option-row").remove();if(msg.result&&msg.result.length>0){$.each(msg.result,function(i,n){try{var value=n[initParam.dynamicResult.resData.id];element.append($("<option/>").addClass("option-row").attr($.extend({value:value},n)).html(n[initParam.dynamicResult.resData.value]))}catch(e){$.hy_error(e,"initParam.dynamicResult msg.result ")}})}}};$._ajax(opt)}if(initParam.event){$.each(initParam.event,function(j,m){element.bind(m.name,function(){_this[m.func](field,m)})})}}catch(e){$.hy_error(e,"DrawElement.prototype.select")}}if(_this.srcData){element.val(_this.srcData[field.fieldName])}else{$.initValue(element,field.initParam)}$.lvxh_validator(element,field)};DrawElement.prototype.changeSelect=function(field,events){var _this=this;if(events.changeNodes){$.each(events.changeNodes,function(i,n){var temp=_this.tempNode[n];if(temp){_this[temp.field.fieldType](temp.field)}})}};